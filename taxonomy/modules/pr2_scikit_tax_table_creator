import pandas as pd
from taxonomy.modules.taxonomy_table_creator import TaxonomyTableCreator

from pathlib import Path

# TODO: Split out kindgom phylum class, etc. From Sam: "Levels of taxonomy for pr2:  Domain (replacing Kingdom), Supergroup, Division, Subdivision (new taxonomic rank added), Class, Order, Family, Genus, Species"

class Pr2ScikitTaxTableCreator(TaxonomyTableCreator):

    PR2_SCIKIT_SEQ_COL = "Feature ID"
    PR2_SCIKIT_TAXON_COL = "Taxon"
    PR2_SCIKIT_CONFIDENCE_COL = "Confidence"

    def __init__(self, taxon_tble_file: str, asv_dna_seq_file: str, final_faire_excel_path: str):
        """
        taxon_table_file: The path to the taxonomy table.txt file
        asv_dna_seq_file: The path to the file with the asv/dna sequences
        final_faire_excel_path: The path to save the final excel file to
        """

        super().__init__(taxon_tble_file, asv_dna_seq_file, final_faire_excel_path)

    @property
    def taxonomy_cols(self):
        return [self.KINGDOM, self.SUPERGROUP, self.DIVISION, self.SUBDIVISION, self.CLASS, self.ORDER, self.FAMILY, self.GENUS, self.SPECIES]
    
    @property
    def taxonomy_unknowns(self):
        return ["NA"]

    def build_faire_df(self) -> pd.DataFrame:
        """
        Load the taxon_tble_file as a data frame
        """
        # Load taxonomy text file as a data frame.
        df = self._load_tab_text_file_as_df(file_path=self.taxon_table_path)

        # Add the dna_seq column
        df_with_dna_seqs = self._create_dna_sequence_col(df=df)

        # Replace ASVs with hashes
        df_with_hashes = self._switch_asv_for_hashes(df=df_with_dna_seqs)
        print("ASVS switched with hashes!")

        # Split Taxon column into separate columns as in FAIRe and make Taxon column become VerbatimIdentification
         